/*
 * Bootloader_core.c
 * SADECE MENU VE YONETIM (Kodlar Ayrildi)
 */

#include "main.h"
#include <stdio.h>
#include <string.h>
#include "Bootloader_flash.h"
#include "Bootloader_config.h"
#include "Bootloader_hex.h"      // HEX XMODEM
#include "Bootloader_raw.h"      // HEX RAW
#include "Bootloader_bin.h"      // BIN XMODEM (Yeni Dosya)

extern UART_HandleTypeDef huart1;

/* ... Renk Kodları ve Define'lar Aynı Kalsın ... */
#define PROMPT_TEXT     "cboot > "
#define CMD_BUFFER_LEN  64

/* Renk Kodları */
#define CLR_RESET   "\033[0m"
#define CLR_RED     "\033[31m"
#define CLR_GREEN   "\033[32m"
#define CLR_YELLOW  "\033[33m"
#define CLR_CYAN    "\033[36m"
#define CLR_BOLD    "\033[1m"
#define CLR_MAGENTA "\033[35m"
#define CLR_WHITE   "\033[37m"

#define USER_NAME "yerdem"

/* ... Bootloader_Print_Logo FONKSIYONU (Aynen Kalsın) ... */
void Bootloader_Print_Logo(void) { /* ... Kodun aynısı ... */ }

/* ... Print_Help_Menu FONKSIYONU (Aynen Kalsın) ... */
void Print_Help_Menu(void) { /* ... Kodun aynısı ... */ }

/* ... CLI_Read_Line FONKSIYONU (Aynen Kalsın) ... */
void CLI_Read_Line(char *buffer, uint16_t max_len) { /* ... Kodun aynısı ... */ }

/* ... Get_Active_Slot_Addr ve Set_Active_Slot (Aynen Kalsın) ... */
uint32_t Get_Active_Slot_Addr(void) { /* ... */ return 0; } // (Kodu kopyala)
void Set_Active_Slot(uint32_t new_slot_flag) { /* ... */ }  // (Kodu kopyala)

/* --- BURADAKİ XMODEM_RECEIVE_FILE VE CRC KODLARINI SIL --- */
/* Çünkü onları Bootloader_bin.c'ye taşıdık */

/* ... Bootloader_Menu_Loop (Aynen Kalsın) ... */
void Bootloader_Menu_Loop(void)
{
   /* ... Kodun aynısı ... */
   /* Sadece şu kısmı kontrol et: */
   else if (strcmp(cmd_buffer, "load_bin") == 0) {
       Xmodem_Receive_File(); // Artık Bootloader_bin.c'den çağırıyor
       HAL_Delay(1000);
   }
   /* ... */
}

/* ... Bootloader_Jump_To_Address (Aynen Kalsın) ... */
void Bootloader_Jump_To_Address(uint32_t jump_addr) { /* ... */ }
